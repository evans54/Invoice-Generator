<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lessy Invoice Generator</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        lessy: {
                            blue: '#1a365d',
                            gold: '#d4af37',
                            light: '#f8f9fa'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Montserrat', sans-serif;
        }
        .invoice-shadow {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .paid-watermark {
            position: absolute;
            opacity: 0.1;
            font-size: 120px;
            transform: rotate(-30deg);
            z-index: 0;
            color: #10b981;
            font-weight: bold;
        }
    </style>
</head>
<body class="bg-lessy-light min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="flex justify-between items-center mb-8">
            <div class="flex items-center">
                <div class="w-16 h-16 bg-lessy-blue rounded-lg flex items-center justify-center mr-4">
                    <i data-feather="file-text" class="text-lessy-gold w-8 h-8"></i>
                </div>
                <h1 class="text-3xl font-bold text-lessy-blue">Lessy Invoice Wizard</h1>
            </div>
            <div class="flex items-center gap-4">
                <button id="receiptsBtn" class="flex items-center text-lessy-blue hover:text-lessy-gold transition">
                    <i data-feather="file-text" class="mr-2"></i>
                    Receipts
                </button>
                <button id="historyBtn" class="flex items-center text-lessy-blue hover:text-lessy-gold transition">
                    <i data-feather="clock" class="mr-2"></i>
                    Invoice History
                </button>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Invoice Form -->
            <div class="bg-white rounded-xl p-6 invoice-shadow">
                <h2 class="text-xl font-semibold text-lessy-blue mb-6">Invoice Details</h2>
                
                <!-- Invoice Info -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Invoice Number</label>
                                                <div class="flex gap-2 items-center">
                                                    <input type="text" id="invoiceNumber" class="w-2/3 px-3 py-2 border border-gray-300 rounded-md" value="INV-0001" readonly>
                                                    <select id="invoiceStatus" class="w-1/3 px-2 py-2 border border-gray-300 rounded-md">
                                                        <option value="pending" selected>Pending</option>
                                                        <option value="paid">Paid</option>
                                                    </select>
                                                </div>
                                                <div class="mt-2">
                                                    <span id="duplicateBadge" class="text-xs text-gray-600 hidden">Duplicate of <strong id="duplicateSource"></strong></span>
                                                </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Issue Date</label>
                        <input type="date" id="issueDate" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Due Date</label>
                        <input type="date" id="dueDate" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Payment Method</label>
                        <select id="paymentMethod" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            <option value="M-Pesa">M-Pesa</option>
                            <option value="PayPal">PayPal</option>
                            <option value="Wise">Wise</option>
                            <option value="Bank Transfer">Bank Transfer</option>
                            <option value="Cash">Cash</option>
                        </select>
                    </div>
                </div>

                <!-- Client Details -->
                <div class="mb-6">
                    <h3 class="text-lg font-medium text-lessy-blue mb-3">Client Information</h3>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Client Name</label>
                            <input type="text" id="clientName" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Company</label>
                                <input type="text" id="clientCompany" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                <input type="email" id="clientEmail" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                                <input type="tel" id="clientPhone" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Address</label>
                                <input type="text" id="clientAddress" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Services Table -->
                <div class="mb-6">
                    <h3 class="text-lg font-medium text-lessy-blue mb-3">Services</h3>
                    <table class="w-full mb-4">
                        <thead>
                            <tr class="border-b">
                                <th class="text-left py-2 text-sm font-medium text-gray-700">Description</th>
                                <th class="text-right py-2 text-sm font-medium text-gray-700">Qty</th>
                                <th class="text-right py-2 text-sm font-medium text-gray-700">Rate</th>
                                <th class="text-right py-2 text-sm font-medium text-gray-700">Amount</th>
                                <th class="w-8"></th>
                            </tr>
                        </thead>
                        <tbody id="servicesTable">
                            <tr class="border-b" data-row="0">
                                <td class="py-2"><input type="text" class="w-full px-2 py-1 border rounded service-desc" placeholder="Service description"></td>
                                <td class="py-2"><input type="number" min="1" value="1" class="w-20 px-2 py-1 border rounded text-right service-qty"></td>
                                <td class="py-2"><input type="number" min="0" step="0.01" class="w-24 px-2 py-1 border rounded text-right service-rate" placeholder="0.00"></td>
                                <td class="py-2"><input type="text" class="w-24 px-2 py-1 border rounded text-right service-amt" placeholder="0.00" readonly></td>
                                <td class="py-2 text-center"><button class="remove-row text-red-500 hover:text-red-700"><i data-feather="trash-2" class="w-4 h-4"></i></button></td>
                            </tr>
                        </tbody>
                    </table>
                    <button id="addService" class="text-lessy-blue hover:text-lessy-gold flex items-center text-sm">
                        <i data-feather="plus" class="w-4 h-4 mr-1"></i> Add Service
                    </button>
                </div>

                <!-- Totals -->
                <div class="mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Tax (%)</label>
                            <input type="number" id="taxRate" min="0" max="100" value="0" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Discount</label>
                            <input type="number" id="discountAmt" min="0" value="0" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Currency</label>
                            <select id="currencySelect" class="w-full px-3 py-2 border border-gray-300 rounded-md mb-2">
                                <option value="KSH">KSH (Kenyan Shilling)</option>
                                <option value="TZS">TZS (Tanzanian Shilling)</option>
                                <option value="USD" selected>USD (US Dollar)</option>
                                <option value="EURO">EURO (Euro)</option>
                                <option value="PUNDS">PUNDS (Pounds / GBP)</option>
                            </select>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Total Due</label>
                            <input type="text" id="totalDue" value="$0.00" class="w-full px-3 py-2 border border-gray-300 rounded-md font-bold text-lg" readonly>
                        </div>
                    </div>
                </div>

                <!-- Notes -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                    <textarea id="invoiceNotes" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="Additional notes or terms..."></textarea>
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-wrap gap-3">
                    <button id="previewBtn" class="px-4 py-2 bg-lessy-blue text-white rounded-md hover:bg-opacity-90 transition flex items-center">
                        <i data-feather="eye" class="mr-2"></i> Preview
                    </button>
                    <button id="generateInvoiceBtn" class="px-4 py-2 bg-lessy-gold text-lessy-blue rounded-md hover:bg-opacity-90 transition flex items-center">
                        <i data-feather="download" class="mr-2"></i> Download Invoice
                    </button>
                    <button id="saveInvoiceBtn" class="px-4 py-2 bg-gray-200 text-lessy-blue rounded-md hover:bg-opacity-90 transition flex items-center">
                        <i data-feather="save" class="mr-2"></i> Save Invoice
                    </button>
                    <button id="createNewInvoiceBtn" class="px-4 py-2 bg-lessy-blue text-white rounded-md hover:bg-opacity-90 transition flex items-center">
                        <i data-feather="plus" class="mr-2"></i> Create New Invoice
                    </button>
                    <button id="duplicateInvoiceBtn" class="px-4 py-2 bg-gray-200 text-lessy-blue rounded-md hover:bg-opacity-90 transition flex items-center">
                        <i data-feather="copy" class="mr-2"></i> Duplicate Invoice
                    </button>
                    <button id="markAsPendingBtn" class="px-4 py-2 bg-yellow-400 text-lessy-blue rounded-md hover:bg-opacity-90 transition flex items-center">
                        <i data-feather="clock" class="mr-2"></i> Mark as Pending
                    </button>
                    <button id="markAsPaidBtn" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-opacity-90 transition flex items-center">
                        <i data-feather="check-circle" class="mr-2"></i> Mark as Paid
                    </button>
                </div>
            </div>

            <!-- Invoice Preview -->
            <div class="bg-white rounded-xl p-6 invoice-shadow">
                <div id="invoicePreview" class="p-6 border border-gray-200 rounded-lg">
                    <!-- Preview content will be generated here -->
                    <div class="text-center py-20 text-gray-400">
                        <i data-feather="file-text" class="w-12 h-12 mx-auto mb-4"></i>
                        <h3 class="text-lg font-medium">Invoice Preview</h3>
                        <p class="text-sm">Fill out the form to see a live preview</p>
                    </div>
                </div>

                <div id="receiptPreview" class="p-6 border border-gray-200 rounded-lg hidden relative">
                    <!-- Receipt content will be generated here -->
                    <div class="paid-watermark">PAID</div>
                </div>

                <div class="mt-4 flex justify-end">
                    <button id="downloadReceiptBtn" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-opacity-90 transition flex items-center hidden">
                        <i data-feather="download" class="mr-2"></i> Download Receipt
                    </button>
                </div>
            </div>

                <!-- Toast container for inline notifications -->
                <div id="toastContainer" class="fixed top-6 right-6 z-50 space-y-2"></div>

                <!-- Spinner overlay when performing server operations -->
                <div id="spinnerOverlay" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center hidden z-50">
                    <div class="bg-white p-4 rounded-lg flex items-center gap-3 shadow-lg">
                        <svg class="animate-spin h-6 w-6 text-lessy-blue" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path></svg>
                        <div class="text-sm">Processingâ€¦</div>
                    </div>
                </div>
        </div>
    </div>

    <!-- Invoice History Modal -->
    <div id="historyModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-xl p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-lessy-blue">Invoice History</h3>
                <button id="closeHistoryModal" class="text-gray-500 hover:text-gray-700">
                    <i data-feather="x" class="w-6 h-6"></i>
                </button>
            </div>
            <div id="historyList" class="space-y-3">
                <!-- Invoice history items will be added here -->
                <div class="text-center py-10 text-gray-400">
                    <i data-feather="clock" class="w-10 h-10 mx-auto mb-4"></i>
                    <p>No invoice history yet</p>
                </div>
            </div>
            <div class="mt-4 flex justify-end gap-2">
                <button id="downloadSelectedHistoryBtn" class="px-3 py-2 bg-lessy-blue text-white rounded">Download Selected</button>
            </div>
        </div>
    </div>

    <!-- Confirm Duplicate Modal -->
    <div id="confirmDuplicateModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-60">
        <div class="bg-white rounded-xl p-6 w-full max-w-md">
            <h3 class="text-lg font-semibold mb-4">Duplicate invoice?</h3>
            <p class="text-sm text-gray-600 mb-4">Do you want to duplicate this invoice into a new draft? This will pre-fill a new invoice form with the existing invoice values and set the next invoice number.</p>
            <div class="flex justify-end gap-3">
                <button id="cancelDuplicateBtn" class="px-3 py-2 bg-gray-200 rounded">Cancel</button>
                <button id="confirmDuplicateBtn" class="px-3 py-2 bg-lessy-blue text-white rounded">Duplicate</button>
            </div>
        </div>
    </div>

    <!-- Confirm Discard Modal -->
    <div id="confirmDiscardModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-60">
        <div class="bg-white rounded-xl p-6 w-full max-w-md">
            <h3 class="text-lg font-semibold mb-4">Discard changes?</h3>
            <p class="text-sm text-gray-600 mb-4">You have unsaved changes. Creating a new invoice will discard them. Continue?</p>
            <div class="flex justify-end gap-3">
                <button id="cancelDiscardBtn" class="px-3 py-2 bg-gray-200 rounded">Cancel</button>
                <button id="confirmDiscardBtn" class="px-3 py-2 bg-red-500 text-white rounded">Discard and Continue</button>
            </div>
        </div>
    </div>

    <!-- Receipts Dashboard Modal -->
    <div id="receiptsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-xl p-6 w-full max-w-3xl max-h-[80vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-lessy-blue">Receipts</h3>
                <button id="closeReceiptsModal" class="text-gray-500 hover:text-gray-700"><i data-feather="x" class="w-6 h-6"></i></button>
            </div>
            <div id="receiptsList" class="space-y-3">
                <div class="text-center py-10 text-gray-400">
                    <i data-feather="file-text" class="w-10 h-10 mx-auto mb-4"></i>
                    <p>No receipts yet</p>
                </div>
            </div>
            <div id="receiptPreviewArea" class="mt-6 hidden">
                <h4 class="text-lg font-medium mb-2">Receipt Preview</h4>
                <div id="receiptPreviewPanel" class="p-4 border rounded"></div>
                <div class="mt-3 flex justify-end gap-2">
                    <button id="downloadSelectedReceiptBtn" class="px-3 py-2 bg-lessy-blue text-white rounded">Download Receipt</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="assets/app.js"></script>
    <noscript>Please enable JavaScript to use the Invoice Generator.</noscript>
</body>
</html>